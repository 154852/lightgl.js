<!DOCTYPE html>  <html> <head>   <title>mesh.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="main.html">                 main.js               </a>                                           <a class="source" href="matrix.html">                 matrix.js               </a>                                           <a class="source" href="mesh.html">                 mesh.js               </a>                                           <a class="source" href="raytracer.html">                 raytracer.js               </a>                                           <a class="source" href="shader.html">                 shader.js               </a>                                           <a class="source" href="texture.html">                 texture.js               </a>                                           <a class="source" href="vector.html">                 vector.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               mesh.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>Represents indexed triangle geometry with arbitrary additional attributes.
You need a shader to draw a mesh; meshes can't draw themselves.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h3>new Indexer()</h3>

<p>Generates indices into a list of unique objects from a stream of objects
that may contain duplicates. This is useful for generating compact indexed
meshes from unindexed data.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Indexer</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">unique</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">indices</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">map</span> <span class="o">=</span> <span class="p">{};</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h3>.add(v)</h3>

<p>Adds the object <code>obj</code> to <code>unique</code> if it hasn't already been added. Returns
the index of <code>obj</code> in <code>unique</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Indexer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">add</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">map</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">map</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">unique</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">unique</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">map</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h3>new Buffer(target, type)</h3>

<p>Provides a simple method of uploading data to a GPU buffer. Example usage:</p>

<pre><code>var vertices = new Buffer(gl.ARRAY_BUFFER, Float32Array);
var indices = new Buffer(gl.ELEMENT_ARRAY_BUFFER, Int16Array);
vertices.data = [[0, 0, 0], [1, 0, 0], [0, 1, 0], [1, 1, 0]];
indices.data = [[0, 1, 2], [2, 1, 3]];
vertices.compile();
indices.compile();
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Buffer</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">buffer</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">target</span> <span class="o">=</span> <span class="nx">target</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">type</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="p">[];</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <h3>.compile(type)</h3>

<p>Upload the contents of <code>data</code> to the GPU in preparation for rendering. The
data must be a list of lists where each inner list has the same length. For
example, each element of data for vertex normals would be a list of length three.
This will remember the data length and element length for later use by shaders.
The type can be either <code>gl.STATIC_DRAW</code> or <code>gl.DYNAMIC_DRAW</code>, and defaults to
<code>gl.STATIC_DRAW</code>.</p>

<p>This could have used <code>[].concat.apply([], this.data)</code> to flatten
the array but Google Chrome has a maximum number of arguments so the
concatenations are chunked to avoid that limit.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Buffer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">compile</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">chunk</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="nx">chunk</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">data</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">concat</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">i</span> <span class="o">+</span> <span class="nx">chunk</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">buffer</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">buffer</span> <span class="o">||</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">buffer</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">buffer</span><span class="p">.</span><span class="nx">spacing</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">length</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    <span class="nx">gl</span><span class="p">.</span><span class="nx">bindBuffer</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">target</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">buffer</span><span class="p">);</span>
    <span class="nx">gl</span><span class="p">.</span><span class="nx">bufferData</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">target</span><span class="p">,</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">type</span><span class="p">(</span><span class="nx">data</span><span class="p">),</span> <span class="nx">type</span> <span class="o">||</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">STATIC_DRAW</span><span class="p">);</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h3>new Mesh([options])</h3>

<p>Represents a collection of vertex buffers and index buffers. Each vertex
buffer maps to one attribute in GLSL and has a corresponding property set
on the Mesh instance. There is one vertex buffer by default: <code>vertices</code>,
which maps to <code>gl_Vertex</code>. The <code>coords</code>, <code>normals</code>, and <code>colors</code> vertex
buffers map to <code>gl_TexCoord</code>, <code>gl_Normal</code>, and <code>gl_Color</code> respectively,
and can be enabled by setting the corresponding options to true. There are
two index buffers, <code>triangles</code> and <code>lines</code>, which are used for rendering
<code>gl.TRIANGLES</code> and <code>gl.LINES</code>, respectively. Only <code>triangles</code> is enabled by
default, although <code>computeWireframe()</code> will add a normal buffer if it wasn't
initially enabled.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Mesh</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">vertexBuffers</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">indexBuffers</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">addVertexBuffer</span><span class="p">(</span><span class="s1">&#39;vertices&#39;</span><span class="p">,</span> <span class="s1">&#39;gl_Vertex&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">coords</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">addVertexBuffer</span><span class="p">(</span><span class="s1">&#39;coords&#39;</span><span class="p">,</span> <span class="s1">&#39;gl_TexCoord&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">normals</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">addVertexBuffer</span><span class="p">(</span><span class="s1">&#39;normals&#39;</span><span class="p">,</span> <span class="s1">&#39;gl_Normal&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">color</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">addVertexBuffer</span><span class="p">(</span><span class="s1">&#39;colors&#39;</span><span class="p">,</span> <span class="s1">&#39;gl_Color&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="s1">&#39;triangles&#39;</span> <span class="k">in</span> <span class="nx">options</span><span class="p">)</span> <span class="o">||</span> <span class="nx">options</span><span class="p">.</span><span class="nx">triangles</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">addIndexBuffer</span><span class="p">(</span><span class="s1">&#39;triangles&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">lines</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">addIndexBuffer</span><span class="p">(</span><span class="s1">&#39;lines&#39;</span><span class="p">);</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <h3>.addVertexBuffer(name, attribute)</h3>

<p>Add a new vertex buffer with a list as a property called <code>name</code> on this object
and map it to the attribute called <code>attribute</code> in all shaders that draw this mesh.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Mesh</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addVertexBuffer</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">attribute</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">buffer</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vertexBuffers</span><span class="p">[</span><span class="nx">attribute</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Buffer</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">Float32Array</span><span class="p">);</span>
    <span class="nx">buffer</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
    <span class="k">this</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <h3>.addIndexBuffer(name)</h3>

<p>Add a new index buffer with a list as a property called <code>name</code> on this object.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Mesh</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addIndexBuffer</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">buffer</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">indexBuffers</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Buffer</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ELEMENT_ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">Int16Array</span><span class="p">);</span>
    <span class="k">this</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <h3>.compile()</h3>

<p>Upload all attached buffers to the GPU in preparation for rendering. This
doesn't need to be called every frame, only needs to be done when the data
changes.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Mesh</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">compile</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">attribute</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">vertexBuffers</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">buffer</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vertexBuffers</span><span class="p">[</span><span class="nx">attribute</span><span class="p">];</span>
        <span class="nx">buffer</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="nx">buffer</span><span class="p">.</span><span class="nx">name</span><span class="p">];</span>
        <span class="nx">buffer</span><span class="p">.</span><span class="nx">compile</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">name</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">indexBuffers</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">buffer</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">indexBuffers</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
        <span class="nx">buffer</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
        <span class="nx">buffer</span><span class="p">.</span><span class="nx">compile</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <h3>.transform(matrix)</h3>

<p>Transform all vertices by <code>matrix</code> and all normals by the inverse transpose
of <code>matrix</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Mesh</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">transform</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">matrix</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">vertices</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vertices</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">matrix</span><span class="p">.</span><span class="nx">transformPoint</span><span class="p">(</span><span class="nx">Vector</span><span class="p">.</span><span class="nx">fromArray</span><span class="p">(</span><span class="nx">v</span><span class="p">)).</span><span class="nx">toArray</span><span class="p">();</span>
    <span class="p">});</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">normals</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">invTrans</span> <span class="o">=</span> <span class="nx">matrix</span><span class="p">.</span><span class="nx">inverse</span><span class="p">().</span><span class="nx">transpose</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">normals</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">normals</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">invTrans</span><span class="p">.</span><span class="nx">transformVector</span><span class="p">(</span><span class="nx">Vector</span><span class="p">.</span><span class="nx">fromArray</span><span class="p">(</span><span class="nx">n</span><span class="p">)).</span><span class="nx">unit</span><span class="p">().</span><span class="nx">toArray</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">compile</span><span class="p">();</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <h3>.computeNormals()</h3>

<p>Computes a new normal for each vertex from the average normal of the
neighboring triangles. This means adjacent triangles must share vertices
for the resulting normals to be smooth.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Mesh</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">computeNormals</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">normals</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">addVertexBuffer</span><span class="p">(</span><span class="s1">&#39;normals&#39;</span><span class="p">,</span> <span class="s1">&#39;gl_Normal&#39;</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">vertices</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">normals</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vector</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">triangles</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">triangles</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">Vector</span><span class="p">.</span><span class="nx">fromArray</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">vertices</span><span class="p">[</span><span class="nx">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]]);</span>
        <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">Vector</span><span class="p">.</span><span class="nx">fromArray</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">vertices</span><span class="p">[</span><span class="nx">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]]);</span>
        <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">Vector</span><span class="p">.</span><span class="nx">fromArray</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">vertices</span><span class="p">[</span><span class="nx">t</span><span class="p">[</span><span class="mi">2</span><span class="p">]]);</span>
        <span class="kd">var</span> <span class="nx">normal</span> <span class="o">=</span> <span class="nx">b</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">a</span><span class="p">).</span><span class="nx">cross</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">a</span><span class="p">)).</span><span class="nx">unit</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">normals</span><span class="p">[</span><span class="nx">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">normals</span><span class="p">[</span><span class="nx">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]].</span><span class="nx">add</span><span class="p">(</span><span class="nx">normal</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">normals</span><span class="p">[</span><span class="nx">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">normals</span><span class="p">[</span><span class="nx">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]].</span><span class="nx">add</span><span class="p">(</span><span class="nx">normal</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">normals</span><span class="p">[</span><span class="nx">t</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">normals</span><span class="p">[</span><span class="nx">t</span><span class="p">[</span><span class="mi">2</span><span class="p">]].</span><span class="nx">add</span><span class="p">(</span><span class="nx">normal</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">vertices</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">normals</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">normals</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">unit</span><span class="p">().</span><span class="nx">toArray</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">compile</span><span class="p">();</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <h3>.computeWireframe()</h3>

<p>Populate the <code>lines</code> index buffer from the <code>triangles</code> index buffer.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Mesh</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">computeWireframe</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">indexer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Indexer</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">triangles</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">triangles</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">t</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">t</span><span class="p">[</span><span class="nx">j</span><span class="p">],</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">t</span><span class="p">[(</span><span class="nx">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nx">t</span><span class="p">.</span><span class="nx">length</span><span class="p">];</span>
            <span class="nx">indexer</span><span class="p">.</span><span class="nx">add</span><span class="p">([</span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)]);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">lines</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">addIndexBuffer</span><span class="p">(</span><span class="s1">&#39;lines&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">lines</span> <span class="o">=</span> <span class="nx">indexer</span><span class="p">.</span><span class="nx">unique</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">compile</span><span class="p">();</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <h3>.getAABB()</h3>

<p>Computes the axis-aligned bounding box, which is an object whose <code>min</code> and
<code>max</code> properties contain the minimum and maximum coordinates of all vertices.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Mesh</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getAABB</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">aabb</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">min</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Vector</span><span class="p">(</span><span class="nb">Number</span><span class="p">.</span><span class="nx">MAX_VALUE</span><span class="p">,</span> <span class="nb">Number</span><span class="p">.</span><span class="nx">MAX_VALUE</span><span class="p">,</span> <span class="nb">Number</span><span class="p">.</span><span class="nx">MAX_VALUE</span><span class="p">)</span> <span class="p">};</span>
    <span class="nx">aabb</span><span class="p">.</span><span class="nx">max</span> <span class="o">=</span> <span class="nx">aabb</span><span class="p">.</span><span class="nx">min</span><span class="p">.</span><span class="nx">negative</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">vertices</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">v</span> <span class="o">=</span> <span class="nx">Vector</span><span class="p">.</span><span class="nx">fromArray</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">vertices</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
        <span class="nx">aabb</span><span class="p">.</span><span class="nx">min</span> <span class="o">=</span> <span class="nx">Vector</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">min</span><span class="p">,</span> <span class="nx">v</span><span class="p">);</span>
        <span class="nx">aabb</span><span class="p">.</span><span class="nx">max</span> <span class="o">=</span> <span class="nx">Vector</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">max</span><span class="p">,</span> <span class="nx">v</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">aabb</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <h3>.getBoundingSphere()</h3>

<p>Computes a sphere that contains all vertices (not necessarily the smallest
sphere). The returned object has two properties, <code>center</code> and <code>radius</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Mesh</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getBoundingSphere</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">aabb</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getAABB</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">sphere</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">center</span><span class="o">:</span> <span class="nx">aabb</span><span class="p">.</span><span class="nx">min</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">aabb</span><span class="p">.</span><span class="nx">max</span><span class="p">).</span><span class="nx">divide</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="nx">radius</span><span class="o">:</span> <span class="mi">0</span> <span class="p">};</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">vertices</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">sphere</span><span class="p">.</span><span class="nx">radius</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">sphere</span><span class="p">.</span><span class="nx">radius</span><span class="p">,</span>
            <span class="nx">Vector</span><span class="p">.</span><span class="nx">fromArray</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">vertices</span><span class="p">[</span><span class="nx">i</span><span class="p">]).</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">sphere</span><span class="p">.</span><span class="nx">center</span><span class="p">).</span><span class="nx">length</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">sphere</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <h3>Mesh.plane([detailX, detailY, options])</h3>

<p>Generates a square 2x2 mesh the xy plane centered at the origin. The mesh
is a grid of <code>detailX</code> by <code>detailY</code> cells. Only generates a single cell
by default.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Mesh</span><span class="p">.</span><span class="nx">plane</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">detailX</span><span class="p">,</span> <span class="nx">detailY</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">mesh</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Mesh</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
    <span class="nx">detailX</span> <span class="o">=</span> <span class="nx">detailX</span> <span class="o">||</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nx">detailY</span> <span class="o">=</span> <span class="nx">detailY</span> <span class="o">||</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">y</span> <span class="o">&lt;=</span> <span class="nx">detailY</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="nx">y</span> <span class="o">/</span> <span class="nx">detailY</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">x</span> <span class="o">&lt;=</span> <span class="nx">detailX</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">x</span> <span class="o">/</span> <span class="nx">detailX</span><span class="p">;</span>
            <span class="nx">mesh</span><span class="p">.</span><span class="nx">vertices</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="mi">2</span> <span class="o">*</span> <span class="nx">s</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="nx">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">coords</span><span class="p">)</span> <span class="nx">mesh</span><span class="p">.</span><span class="nx">coords</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="nx">s</span><span class="p">,</span> <span class="nx">t</span><span class="p">]);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">normals</span><span class="p">)</span> <span class="nx">mesh</span><span class="p">.</span><span class="nx">normals</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">detailX</span> <span class="o">&amp;&amp;</span> <span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">detailY</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">y</span> <span class="o">*</span> <span class="p">(</span><span class="nx">detailX</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
                <span class="nx">mesh</span><span class="p">.</span><span class="nx">triangles</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="nx">i</span><span class="p">,</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">i</span> <span class="o">+</span> <span class="nx">detailX</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]);</span>
                <span class="nx">mesh</span><span class="p">.</span><span class="nx">triangles</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="nx">i</span> <span class="o">+</span> <span class="nx">detailX</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">i</span> <span class="o">+</span> <span class="nx">detailX</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">mesh</span><span class="p">.</span><span class="nx">compile</span><span class="p">();</span>
    <span class="k">return</span> <span class="nx">mesh</span><span class="p">;</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">cubeData</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="c1">// -x</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="c1">// +x</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="c1">// -y</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="c1">// +y</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="c1">// -z</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">+</span><span class="mi">1</span><span class="p">]</span>  <span class="c1">// +z</span>
<span class="p">];</span>

<span class="kd">function</span> <span class="nx">pickOctant</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Vector</span><span class="p">((</span><span class="nx">i</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&amp;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <h3>Mesh.cube([options])</h3>

<p>Generates a 2x2x2 box centered at the origin.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Mesh</span><span class="p">.</span><span class="nx">cube</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">mesh</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Mesh</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">cubeData</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">cubeData</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">v</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">*</span> <span class="mi">4</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
            <span class="nx">mesh</span><span class="p">.</span><span class="nx">vertices</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">pickOctant</span><span class="p">(</span><span class="nx">d</span><span class="p">).</span><span class="nx">toArray</span><span class="p">());</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">coords</span><span class="p">)</span> <span class="nx">mesh</span><span class="p">.</span><span class="nx">coords</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="nx">j</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="nx">j</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">normals</span><span class="p">)</span> <span class="nx">mesh</span><span class="p">.</span><span class="nx">normals</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="nx">data</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="nx">data</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="nx">data</span><span class="p">[</span><span class="mi">6</span><span class="p">]]);</span>
        <span class="p">}</span>
        <span class="nx">mesh</span><span class="p">.</span><span class="nx">triangles</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="nx">v</span><span class="p">,</span> <span class="nx">v</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">v</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]);</span>
        <span class="nx">mesh</span><span class="p">.</span><span class="nx">triangles</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="nx">v</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">v</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">v</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="nx">mesh</span><span class="p">.</span><span class="nx">compile</span><span class="p">();</span>
    <span class="k">return</span> <span class="nx">mesh</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <h3>Mesh.sphere([detail, options])</h3>

<p>Generates a geodesic sphere of radius 1 with <code>detail * detail</code> facets
per octant. Generates 36 facets per octant by default.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Mesh</span><span class="p">.</span><span class="nx">sphere</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">detail</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">tri</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">flip</span> <span class="o">?</span> <span class="p">[</span><span class="nx">a</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">b</span><span class="p">]</span> <span class="o">:</span> <span class="p">[</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">];</span> <span class="p">}</span>
    <span class="kd">function</span> <span class="nx">fix</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">x</span> <span class="o">+</span> <span class="p">(</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">mesh</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Mesh</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">indexer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Indexer</span><span class="p">();</span>
    <span class="nx">detail</span> <span class="o">=</span> <span class="nx">detail</span> <span class="o">||</span> <span class="mi">6</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">octant</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">octant</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="nx">octant</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">scale</span> <span class="o">=</span> <span class="nx">pickOctant</span><span class="p">(</span><span class="nx">octant</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">flip</span> <span class="o">=</span> <span class="nx">scale</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">scale</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">scale</span><span class="p">.</span><span class="nx">z</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">detail</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Generate a row of vertices on the surface of the sphere
using barycentric coordinates.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+</span> <span class="nx">j</span> <span class="o">&lt;=</span> <span class="nx">detail</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">/</span> <span class="nx">detail</span><span class="p">;</span>
                <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">j</span> <span class="o">/</span> <span class="nx">detail</span><span class="p">;</span>
                <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="p">(</span><span class="nx">detail</span> <span class="o">-</span> <span class="nx">i</span> <span class="o">-</span> <span class="nx">j</span><span class="p">)</span> <span class="o">/</span> <span class="nx">detail</span><span class="p">;</span>
                <span class="kd">var</span> <span class="nx">vertex</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">vertex</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Vector</span><span class="p">(</span><span class="nx">fix</span><span class="p">(</span><span class="nx">a</span><span class="p">),</span> <span class="nx">fix</span><span class="p">(</span><span class="nx">b</span><span class="p">),</span> <span class="nx">fix</span><span class="p">(</span><span class="nx">c</span><span class="p">)).</span><span class="nx">unit</span><span class="p">().</span><span class="nx">multiply</span><span class="p">(</span><span class="nx">scale</span><span class="p">).</span><span class="nx">toArray</span><span class="p">()</span> <span class="p">};</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">coords</span><span class="p">)</span> <span class="nx">vertex</span><span class="p">.</span><span class="nx">coord</span> <span class="o">=</span> <span class="nx">scale</span><span class="p">.</span><span class="nx">y</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">c</span><span class="p">]</span> <span class="o">:</span> <span class="p">[</span><span class="nx">c</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="nx">a</span><span class="p">];</span>
                <span class="nx">data</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">indexer</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">vertex</span><span class="p">));</span>
            <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Generate triangles from this row and the previous row.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+</span> <span class="nx">j</span> <span class="o">&lt;=</span> <span class="nx">detail</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="p">(</span><span class="nx">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nx">detail</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="nx">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nx">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nx">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="nx">j</span><span class="p">;</span>
                    <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">*</span> <span class="p">(</span><span class="nx">detail</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">i</span> <span class="o">-</span> <span class="nx">i</span> <span class="o">*</span> <span class="nx">i</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="nx">j</span><span class="p">;</span>
                    <span class="nx">mesh</span><span class="p">.</span><span class="nx">triangles</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">tri</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">a</span><span class="p">],</span> <span class="nx">data</span><span class="p">[</span><span class="nx">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="nx">data</span><span class="p">[</span><span class="nx">b</span><span class="p">]));</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">+</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">detail</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">mesh</span><span class="p">.</span><span class="nx">triangles</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">tri</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">b</span><span class="p">],</span> <span class="nx">data</span><span class="p">[</span><span class="nx">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="nx">data</span><span class="p">[</span><span class="nx">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]));</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Reconstruct the geometry from the indexer.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">mesh</span><span class="p">.</span><span class="nx">vertices</span> <span class="o">=</span> <span class="nx">indexer</span><span class="p">.</span><span class="nx">unique</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">v</span><span class="p">.</span><span class="nx">vertex</span><span class="p">;</span> <span class="p">});</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">coords</span><span class="p">)</span> <span class="nx">mesh</span><span class="p">.</span><span class="nx">coords</span> <span class="o">=</span> <span class="nx">indexer</span><span class="p">.</span><span class="nx">unique</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">v</span><span class="p">.</span><span class="nx">coord</span><span class="p">;</span> <span class="p">});</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">normals</span><span class="p">)</span> <span class="nx">mesh</span><span class="p">.</span><span class="nx">normals</span> <span class="o">=</span> <span class="nx">mesh</span><span class="p">.</span><span class="nx">vertices</span><span class="p">;</span>
    <span class="nx">mesh</span><span class="p">.</span><span class="nx">compile</span><span class="p">();</span>
    <span class="k">return</span> <span class="nx">mesh</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <h3>Mesh.load(json[, options])</h3>

<p>Creates a mesh from the JSON generated by the <code>convert/convert.py</code> script.
Example usage:</p>

<pre><code>var data = {
    vertices: [[0, 0, 0], [1, 0, 0], [0, 1, 0]],
    triangles: [0, 1, 2]
};
var mesh = Mesh.load(data);
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Mesh</span><span class="p">.</span><span class="nx">load</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="s1">&#39;coords&#39;</span> <span class="k">in</span> <span class="nx">options</span><span class="p">))</span> <span class="nx">options</span><span class="p">.</span><span class="nx">coords</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">json</span><span class="p">.</span><span class="nx">coords</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="s1">&#39;normals&#39;</span> <span class="k">in</span> <span class="nx">options</span><span class="p">))</span> <span class="nx">options</span><span class="p">.</span><span class="nx">normals</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">json</span><span class="p">.</span><span class="nx">normals</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">mesh</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Mesh</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
    <span class="nx">mesh</span><span class="p">.</span><span class="nx">vertices</span> <span class="o">=</span> <span class="nx">json</span><span class="p">.</span><span class="nx">vertices</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">coords</span><span class="p">)</span> <span class="nx">mesh</span><span class="p">.</span><span class="nx">coords</span> <span class="o">=</span> <span class="nx">json</span><span class="p">.</span><span class="nx">coords</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">mesh</span><span class="p">.</span><span class="nx">normals</span><span class="p">)</span> <span class="nx">mesh</span><span class="p">.</span><span class="nx">normals</span> <span class="o">=</span> <span class="nx">json</span><span class="p">.</span><span class="nx">normals</span><span class="p">;</span>
    <span class="nx">mesh</span><span class="p">.</span><span class="nx">triangles</span> <span class="o">=</span> <span class="nx">json</span><span class="p">.</span><span class="nx">triangles</span> <span class="o">||</span> <span class="p">[];</span>
    <span class="nx">mesh</span><span class="p">.</span><span class="nx">lines</span> <span class="o">=</span> <span class="nx">json</span><span class="p">.</span><span class="nx">lines</span> <span class="o">||</span> <span class="p">[];</span>
    <span class="nx">mesh</span><span class="p">.</span><span class="nx">compile</span><span class="p">();</span>
    <span class="k">return</span> <span class="nx">mesh</span><span class="p">;</span>
<span class="p">};</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 